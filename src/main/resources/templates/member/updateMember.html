<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>로그인</title>
    <script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="/js/index.js"></script>
    <link rel="stylesheet" href="/css/header.css" />
    <link rel="stylesheet" href="/css/loginForm.css" />
    
   <style>
.btn-login{
    margin-left: 45%;
    
}

.popup-content {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}
	
.modal {
  display: none; /* 모달 숨기기 */
  position: fixed;
  z-index: 1;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0, 0, 0, 0.4); /* 배경 흐리게 */
}

.modal-content {
  background-color: #fefefe;
  margin: 15% auto;
  padding: 20px;
  border: 1px solid #888;
  width: 80%;
  text-align: center;
}

.modal-content h2 {
  margin-top: 0;
}

.modal-content p {
  font-size: 1.2em;
}

.modal-close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.modal-close:hover,
.modal-close:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
}
   </style> 
    
    <script th:inline="javascript">
    

    function updateMember() {
    	
    	
        let name = $("#name").val();
        let phone_number = $("#phone_number").val();
        console.log(phone_number);
        let password = $("#password").val();
        let password2 = $("#password2").val();
    	let oldPassword =[[${loginMember.password}]];

      // 리플 내용이 없으면 등록하지 않는다.
      if (name === "") {
        alert("[[#{alert.alertName}]]");
        return;
      }
      if (phone_number === "") {
        alert("[[#{alert.alertPhone}]]");
        return;
      }
      if (password === "") {
    	     alert("[[#{alert.plsPas}]]");
    	     return;
    	   }
  	   if (password2 === "") {
  	     alert("[[#{alert.plsPas2}]]");
  	     return;
    	   }
  	 if (password !== password2) {
  	     alert("[[#{alert.plsPas3}]]");
  	     return;
  	   }
  	if (password.length < 4 || password.length > 20) {
<<<<<<< HEAD
		alert("[[#{alert.alertPassword}]]");
=======
		alert("비밀번호는 4 ~ 10자리 사이여야 합니다.");
>>>>>>> 46eb390711448e1bbe87d3a48f6bcb9b79cf88ee
		password.focus();
		return ;
	}
  	if (password=== oldPassword) {
		alert("[[#{alert.alertpas}]]");
		password.focus();
		return ;
	}
  	if (phone_number.charAt(3) !== '-' || phone_number.charAt(8) !== '-') {
        alert("[[#{alert.alertcharAt}]]");
        phone_number.focus();
        return false;
    }
    if (phone_number.length !== 13) {
        alert("[[#{alert.alertlength}]]");
        phone_number.focus();
        return false;
    }
  	
    $.ajax({
        url: "/member/updateMember",
        type: "post",
        data: {
        	name: name,
            password:password,
            phone_number:phone_number,
        },
        
        success: function (data, success, xhr) {
        	
        	    // 비밀번호를 모달 창에 표시
        	    document.getElementById("password").innerHTML = password;

        	    // 모달 열기
        	    const modal = document.querySelector(".modal");
        	    modal.style.display = "block";

        	    // 카운트다운 시작
        	    let timeLeft = 3; // 3초 카운트다운
        	    const countDownEl = document.getElementById("countdown"); // 카운트다운을 표시할 엘리먼트
        	    countDownEl.innerHTML = `창이 ${timeLeft}초 후에 자동으로 닫힙니다.`;

        	    const timer = setInterval(() => {
        	      if (timeLeft <= 0) {
        	        clearInterval(timer);
        	        modal.style.display = "none"; // 모달 닫기
        	        opener.location.href = '/member/myPage';
                    window.close();
        	      } else {
        	        countDownEl.innerHTML = `창이 ${timeLeft}초 후에 자동으로 닫힙니다.`;
        	        timeLeft--;
        	      }
        	    }, 1000);

        	}
        ,error: function (xhr, status, error) {
       	alert("[[#{alert.alertupdate}]]");
          console.log(status);
        }
      });
    }

	
    </script>
</head>
<body>
	
    <div class="popup-content">
	  <div id="login-container">
        <img class="img" src="/image/bugi.png" alt="bugi">
			<form  th:object="${findIdForm}" >
<<<<<<< HEAD
	            <h1>[[#{alert.FindPas}]]</h1>
	            <div class="login-input">
	                <input type="text" id="name" th:field="${findIdForm.name}" th:attr="placeholder=#{${'alert.plsName'}}">
	                <input type="text" id="phone_number" th:field="${findIdForm.phone_number}" th:attr="placeholder=#{${'alert.plsPhone'}}">
	                <input type="text" id="password"th:field="${findIdForm.password}" th:attr="placeholder=#{${'alert.plsPas'}}">
	                <input type="text" id="password2" th:attr="placeholder=#{${'alert.plsPas2'}}">
=======
	            <h1>Update Information</h1>
	            <div class="login-input">
	                <input type="text" id="name" th:field="${loginMember.name}" placeholder="  이름을 입력해주세요.">
	                <input type="text" id="phone_number" th:field="${loginMember.phone_number}" placeholder="   전화번호를 '-'와 함께 입력해주세요.">
	                <input type="text" id="password" placeholder="   비밀번호를 입력해주세요.">
	                <input type="text" id="password2" placeholder="   비밀번호를 재입력해주세요.">
>>>>>>> 46eb390711448e1bbe87d3a48f6bcb9b79cf88ee
	            </div>
	           <script th:inline="javascript">
				$(document).ready(function() {
					  $('input[type="text"]').each(function() {
					    $(this).val($(this).attr('value'));
					  });
					});
			</script>
				<br>
				<br>
<<<<<<< HEAD
	            <div class="login-submit">
				<input class="btn-login" type="button" data-value="#{alert.Password}" th:value="#{alert.Password}" onclick="updateMember()" >
	            </div>
	            <script th:inline="javascript">
				$(document).ready(function() {
					  $('input[type="button"]').each(function() {
					    $(this).val($(this).attr('value'));
					  });
					});
				</script>
=======
	            
>>>>>>> 46eb390711448e1bbe87d3a48f6bcb9b79cf88ee
	            <div id="countdown"></div>
       		 </form>
       		 <div class="login-submit">
				<input class="btn-login" type="button" value="UPDATE" onclick="updateMember()" >
	            </div>
         </div> 
    	</div>
    
    
    <div class="modal">
	    <div class="modal-content">
	      <h2>회원 정보가 변경되었습니다.</h2>
	      <p>마이 페이지로 이동합니다.</p>
	    </div>
  </div>
  
  
</body>
</html>